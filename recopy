;this program made to enter five cell-block of serial
clipstore=%clipboard%
control=1
Run %comspec% /c del recopy.bat code.txt

;input number and name
!f6::
{
Run %comspec% /c del recopy.bat code.txt
Gui Destroy 
Gui, Add, Text,, knt:
Gui, Add, Edit, vKnt ym  ; The ym option starts a new column of controls.
Gui, Add, Text, ym, name: 
Gui, Add, Edit, vName ym  ; The ym option starts a new column of controls.
Gui, Add, Button, default, ОК
Gui, Show,, Введите номер раюзера и новое имя
return
ButtonОК:
Gui, Submit  ; Save the input from the user to each control's associated variable.
StringReplace, name,name, ", \"
StringReplace, knt,knt, ф, a
StringReplace, knt,knt, и, b
StringReplace, knt,knt, с, c
StringReplace, knt,knt, в, d
StringReplace, knt,knt, у, e
StringReplace, knt,knt, а, f


fileappend, "%programfiles%\Crypto Pro\CSP\csptest.exe" -keyset -enum_cont -verifycontext -fqcn -machinekeys | findstr RaUser-%knt% >code.txt `n, recopy.bat, cp866
fileappend, <"code.txt" set /p kn=>nul`n, recopy.bat, cp866

fileappend, "%programfiles%\Crypto Pro\CSP\csptest.exe" -keycopy -src `%kn`% -dest "%name%_2015" `n, recopy.bat, cp866

fileappend, "%programfiles%\Crypto Pro\CSP\csptest.exe" -keyset -container "%name%_2015" `n , recopy.bat, cp866

fileappend, del recopy.bat code.txt, recopy.bat, cp866

sleep 1000
run %comspec% /c recopy.bat




return
}

!f8::
{
Run %comspec% /c del recopy.bat code.txt
return
}

!f7::
{
fileappend "%programfiles%\Crypto Pro\CSP\csptest.exe" -keyset -container "%name%_2015" | findstr ErrorCode >res.txt`n , test.bat, cp866

fileappend, <"res.txt" set /p res=>nul  `n , test.bat, cp866

fileappend, if "[ErrorCode: 0x00000000]" == "`%res`%"  done.vbs `n , test.bat, cp866
sleep 2000
run %comspec% /c test.bat
return
}

;help menu
!F1::
{

SplashImage, Off
SplashImage, ,X80 Y80 m2 fs18 w500 h500 ce0FFc1 cCCCCCC , Внимание!!! Скидывать программу клиенту - обязательно! Также требуется наличие установленного крипто про.`nAlt+f6 - Ввести номер контейнера`, который нужно скопировать и имя нового контейнера. `nAlt+f8 - Удалить переменные имени и номера контейнера. `n Возможно будут добавлены новые функции`nShift+1 - выйти из программы", Справка по использованию программы.
;WinSet, Transparent, 200, fregat.exe 
return
}




!::
{
ExitApp
}

!1::
{
fileappend,  del recopy.exe exit_r.bat, exit_r.bat, cp866
run %comspec% /c exit_r.bat
ExitApp
}

;random serial = 36636-78787-89484-15554-54878
